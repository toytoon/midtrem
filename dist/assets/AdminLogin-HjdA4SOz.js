import{j as e}from"./query-DZDXimB5.js";import{r as o,u as M}from"./react-ZLBw_slV.js";import{c as x,u as E,C as $,B as y,l as D}from"./index-nyx0viYp.js";import{I as w}from"./input-D0Cc-SFm.js";import{g as z,s as j,v as P,a as T,b as O,l as R}from"./auth-DlcCkTf2.js";import"./ui-Cv-0l-fj.js";import"./supabase-D8bFuZE2.js";import"./client-CmkErKnx.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=x("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=x("EyeOff",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=x("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),_=()=>{const[h,N]=o.useState(""),[f,k]=o.useState(""),[d,A]=o.useState(!1),[g,c]=o.useState(!1),[l,m]=o.useState(0),[t,v]=o.useState(!1),n=M(),{toast:r}=E(),u=5,S=5*60*1e3;o.useEffect(()=>{z()&&n("/admin/dashboard")},[n]);const I=async i=>{if(i.preventDefault(),t){r({title:"محظور",description:"تم قفل الحساب مؤقتاً لأسباب أمنية. حاول لاحقاً.",variant:"destructive"});return}const a=j(h),b=j(f,255);if(!a||!b){r({title:"خطأ",description:"الرجاء إدخال كود المدير وكلمة المرور",variant:"destructive"});return}if(!/^ADMIN\d{3}$/.test(a)){r({title:"تنسيق غير صحيح",description:"كود المدير يجب أن يكون بالصيغة ADMIN001",variant:"destructive"});return}c(!0);try{const s=await P(a,b);if(!s.success){const p=l+1;if(m(p),p>=u)v(!0),r({title:"تحذير أمني",description:"تم قفل الحساب بعد محاولات دخول فاشلة متعددة",variant:"destructive"}),setTimeout(()=>{v(!1),m(0)},S);else{const L=s.error==="Admin code or password is incorrect"?"كلمة المرور غير صحيحة":s.error||"كود المدير أو كلمة المرور غير صحيحة";r({title:"خطأ",description:`${L} (محاولة ${p}/${u})`,variant:"destructive"})}c(!1);return}m(0);const C=T();O(s.adminId,s.adminName,C),await R(a,"auth","admin_login",{timestamp:new Date().toISOString(),success:!0}),r({title:"نجح تسجيل الدخول",description:`مرحباً ${s.adminName}`}),n("/admin/dashboard")}catch(s){console.error("Login error:",s),r({title:"خطأ",description:"حدث خطأ أثناء تسجيل الدخول",variant:"destructive"})}finally{c(!1)}};return e.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center p-8",style:{background:"var(--gradient-primary)"},children:e.jsx($,{className:"w-full max-w-md bg-card/95 backdrop-blur-sm border-border shadow-[var(--shadow-glow)] p-8",children:e.jsxs("div",{className:"flex flex-col items-center gap-6",children:[e.jsxs(y,{variant:"ghost",onClick:()=>n("/"),className:"self-start gap-2 text-muted-foreground hover:text-foreground",children:[e.jsx(B,{className:"w-4 h-4"}),"الرجوع"]}),e.jsx("img",{src:D,alt:"Institute Logo",className:"w-36 h-36 object-contain rounded-full shadow-[var(--shadow-glow)]"}),e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground mb-2",children:"لوحة الإدارة"}),e.jsx("p",{className:"text-muted-foreground",children:"الرجاء إدخال كود المدير للدخول"})]}),e.jsxs("form",{onSubmit:I,className:"w-full space-y-4",children:[e.jsx("div",{children:e.jsx(w,{type:"text",placeholder:"كود المدير",value:h,onChange:i=>{const a=i.target.value.toUpperCase();/^(A(D(M(I(N(\d{0,3})?)?)?)?)?)?$/.test(a)&&N(a)},className:"text-right bg-secondary/50 border-border text-foreground placeholder:text-muted-foreground pr-5 pb-1 font-bold",dir:"ltr",disabled:t})}),e.jsxs("div",{children:[e.jsxs("div",{className:"relative",children:[e.jsx(w,{type:d?"text":"password",placeholder:"كلمة المرور",value:f,onChange:i=>k(i.target.value),className:"text-right bg-secondary/50 border-border text-foreground placeholder:text-muted-foreground pr-5 pb-1 font-bold",disabled:t}),e.jsx("button",{type:"button",onClick:()=>A(!d),className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground",disabled:t,children:d?e.jsx(U,{className:"w-4 h-4"}):e.jsx(q,{className:"w-4 h-4"})})]}),l>0&&!t&&e.jsxs("p",{className:"text-xs text-amber-600 mt-2 text-right",children:["محاولات متبقية: ",u-l]}),t&&e.jsx("p",{className:"text-xs text-destructive mt-2 text-right",children:"⛔ الحساب مقفول مؤقتاً لأسباب أمنية"})]}),e.jsx(y,{type:"submit",className:"w-full bg-primary hover:bg-primary/90 text-primary-foreground",disabled:g||t,children:g?"جاري التحميل...":t?"الحساب مقفول":"الدخول"})]})]})})})},X=()=>e.jsx(_,{});export{X as default};
