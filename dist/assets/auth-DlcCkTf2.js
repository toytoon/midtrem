import{s}from"./client-CmkErKnx.js";const d=()=>Array.from(crypto.getRandomValues(new Uint8Array(32))).map(e=>e.toString(16).padStart(2,"0")).join(""),l=(e,o,r)=>{localStorage.setItem("adminId",e),localStorage.setItem("adminName",o),localStorage.setItem("adminToken",r),localStorage.setItem("adminTokenExpiry",new Date(Date.now()+5*60*1e3).toISOString())},m=()=>{const e=localStorage.getItem("adminId"),o=localStorage.getItem("adminName"),r=localStorage.getItem("adminToken"),a=localStorage.getItem("adminTokenExpiry");return a&&new Date(a)<new Date?(i(),null):e&&o&&r?(localStorage.setItem("adminTokenExpiry",new Date(Date.now()+5*60*1e3).toISOString()),{adminId:e,adminName:o,token:r}):null},i=()=>{localStorage.removeItem("adminId"),localStorage.removeItem("adminName"),localStorage.removeItem("adminToken"),localStorage.removeItem("adminTokenExpiry")},g=async(e,o)=>{try{const{data:r,error:a}=await s.from("admins").select("id, admin_code, admin_name, password_hash").eq("admin_code",e).single();if(a||!r)return console.log("Admin not found:",e),{success:!1,error:"Admin code or password is incorrect"};console.log("Admin found:",e);try{const{data:t,error:n}=await s.rpc("verify_password",{password:o,hash:r.password_hash});return n?(console.error("RPC verification error:",n),{success:!1,error:"Admin code or password is incorrect"}):t===!0?(console.log("Password verified successfully via RPC"),{success:!0,adminId:r.id,adminName:r.admin_name}):(console.log("Password verification failed - incorrect password"),{success:!1,error:"Admin code or password is incorrect"})}catch(t){return console.error("RPC call failed:",t),{success:!1,error:"Authentication service error"}}}catch(r){return console.error("Password verification error:",r),{success:!1,error:"An error occurred during authentication"}}},u=async(e,o,r,a)=>{try{console.log("Admin Action:",{admin_code:e,table_name:o,operation:r,changed_data:a||{},timestamp:new Date().toISOString()})}catch(t){console.error("Failed to log admin action:",t)}},f=(e,o=255)=>e.slice(0,o).trim().replace(/[<>'`]/g,"").split("").filter(r=>r.charCodeAt(0)>=32&&r.charCodeAt(0)!==127).join(""),S=e=>/^[a-zA-Z0-9_-]{3,20}$/.test(e),p=e=>Number.isInteger(e)&&e>=0&&e<=30;export{d as a,l as b,S as c,p as d,i as e,m as g,u as l,f as s,g as v};
