const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/auth-KP9ixS3Z.js","assets/client-B9lTMVOu.js","assets/supabase-BlUD6oWY.js","assets/react-C0SUYmK-.js","assets/auth-utils-B0pbsvyB.js"])))=>i.map(i=>d[i]);
import{j as e}from"./query-K9nIb-JY.js";import{c as g,u as P,_}from"./index-BUpAmCwu.js";import{r,u as $}from"./react-C0SUYmK-.js";import{C as D,B as j}from"./button-CJ1g5yGr.js";import{I as N}from"./input-BFG2cQQY.js";import{g as z,s as A,a as T,b as O}from"./auth-utils-B0pbsvyB.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=g("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=g("EyeOff",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=g("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),U=()=>{const[v,k]=r.useState(""),[b,S]=r.useState(""),[d,I]=r.useState(!1),[w,l]=r.useState(!1),[m,u]=r.useState(0),[s,y]=r.useState(!1),c=$(),{toast:a}=P(),h=5,L=5*60*1e3;r.useEffect(()=>{z()&&c("/admin/dashboard")},[c]);const C=async o=>{if(o.preventDefault(),s){a({title:"محظور",description:"تم قفل الحساب مؤقتاً لأسباب أمنية. حاول لاحقاً.",variant:"destructive"});return}const t=A(v),p=A(b,255);if((!t||!p)&&(a({title:"خطأ",description:"الرجاء إدخال كود المدير و كلمة المرور",variant:"destructive"}),t&&!p)){a({title:"خطأ",description:"الرجاء إدخال كلمة المرور",variant:"destructive"});return}if(!/^ADMIN\d{3}$/.test(t)){a({title:"تنسيق غير صحيح",description:"كود المدير يجب أن يكون مثل ADMIN001",variant:"destructive"});return}l(!0);try{const{verifyAdminPassword:x,logAdminAction:E}=await _(async()=>{const{verifyAdminPassword:n,logAdminAction:f}=await import("./auth-KP9ixS3Z.js");return{verifyAdminPassword:n,logAdminAction:f}},__vite__mapDeps([0,1,2,3,4])),i=await x(t,p);if(!i.success){const n=m+1;if(u(n),n>=h)y(!0),a({title:"تحذير أمني",description:"تم قفل الحساب بعد محاولات دخول فاشلة متعددة",variant:"destructive"}),setTimeout(()=>{y(!1),u(0)},L);else{const f=i.error==="Admin code or password is incorrect"?"كلمة المرور غير صحيحة":i.error||"كود المدير أو كلمة المرور غير صحيحة";a({title:"خطأ",description:`${f} (محاولة ${n}/${h})`,variant:"destructive"})}l(!1);return}u(0);const M=T();O(i.adminId,i.adminName,M,t),await E(t,"auth","admin_login",{timestamp:new Date().toISOString(),success:!0}),a({title:"نجح تسجيل الدخول",description:`مرحباً ${i.adminName}`}),c("/admin/dashboard")}catch(x){console.error("Login error:",x),a({title:"خطأ",description:"حدث خطأ أثناء تسجيل الدخول",variant:"destructive"})}finally{l(!1)}};return e.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center p-8",style:{background:"var(--gradient-primary)"},children:e.jsx(D,{className:"w-full max-w-md bg-card/95 backdrop-blur-sm border-border shadow-[var(--shadow-glow)] p-8",children:e.jsxs("div",{className:"flex flex-col items-center gap-6",children:[e.jsxs(j,{variant:"ghost",onClick:()=>c("/"),className:"self-start gap-2 text-muted-foreground hover:text-foreground",children:[e.jsx(R,{className:"w-4 h-4"}),"الرجوع"]}),e.jsx("img",{src:"/logo.png",alt:"Institute Logo",className:"w-36 h-36 object-contain rounded-full shadow-[var(--shadow-glow)]",fetchPriority:"high",loading:"eager",width:144,height:144}),e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground mb-2",children:"لوحة الإدارة"}),e.jsx("p",{className:"text-muted-foreground",children:"الرجاء إدخال كود المدير للدخول"})]}),e.jsxs("form",{onSubmit:C,className:"w-full space-y-4",children:[e.jsx("div",{children:e.jsx(N,{type:"text",placeholder:"كود المدير",value:v,onChange:o=>{const t=o.target.value.toUpperCase();/^(A(D(M(I(N(\d{0,3})?)?)?)?)?)?$/.test(t)&&k(t)},className:"h-12 text-right bg-secondary/50 border-border text-foreground placeholder:text-muted-foreground pr-5 pb-1 font-bold",dir:"ltr",disabled:s})}),e.jsxs("div",{children:[e.jsxs("div",{className:"relative",children:[e.jsx(N,{type:d?"text":"password",placeholder:"كلمة المرور",value:b,maxLength:20,onChange:o=>{const t=o.target.value;/^[a-zA-Z0-9]*$/.test(t)&&S(t)},className:"h-12 text-right bg-secondary/50 border-border text-foreground placeholder:text-muted-foreground pr-5 pb-1 font-bold",disabled:s}),e.jsx("button",{type:"button",onClick:()=>I(!d),className:"absolute left-3 top-1/2 -translate-y-1/2 text-foreground hover:text-primary transition-colors p-2 min-h-[44px] min-w-[44px] flex items-center justify-center",disabled:s,"aria-label":d?"إخفاء كلمة المرور":"عرض كلمة المرور",children:d?e.jsx(q,{className:"w-5 h-5"}):e.jsx(B,{className:"w-5 h-5"})})]}),m>0&&!s&&e.jsxs("p",{className:"text-xs text-amber-600 mt-2 text-right",children:["محاولات متبقية: ",h-m]}),s&&e.jsx("p",{className:"text-xs text-destructive mt-2 text-right",children:"⛔ الحساب مقفول مؤقتاً لأسباب أمنية"})]}),e.jsx(j,{type:"submit",className:"w-full h-12 bg-sky-600 hover:bg-sky-700 text-white font-bold",disabled:w||s,children:w?"جاري التحميل...":s?"الحساب مقفول":"الدخول"})]})]})})})},K=()=>e.jsx(U,{});export{K as default};
